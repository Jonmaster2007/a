-- noclip module
local RunService = game:GetService("RunService")

local NoclipConn = nil
local Clip = true

local function noclip()
    Clip = false
    task.wait(0.1)

    if NoclipConn then
        NoclipConn:Disconnect()
        NoclipConn = nil
    end

    NoclipConn = RunService.Stepped:Connect(function()
        local plr = game.Players.LocalPlayer
        local char = plr and plr.Character
        if Clip or not char then return end

        for _, part in ipairs(char:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = false
            end
        end
    end)
end

local function clip()
    Clip = true
    if NoclipConn then
        NoclipConn:Disconnect()
        NoclipConn = nil
    end

    -- restore collisions
    local plr = game.Players.LocalPlayer
    local char = plr and plr.Character
    if char then
        for _, part in ipairs(char:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = true
            end
        end
    end
end

local function toggle()
    if Clip then
        noclip()
    else
        clip()
    end
end

_G.NoclipModule = {
    noclip = noclip,
    clip = clip,
    toggle = toggle,
}
