-- Corrected noclip module
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local LocalPlayer = Players.LocalPlayer
local floatName = "FloatPart" -- DO NOT SET THIS TO HumanoidRootPart

local Clip = true
local Noclipping = nil

_G.NoclipModule = {}

local function NoclipLoop()
    local char = LocalPlayer.Character
    if Clip or not char then return end

    for _, child in ipairs(char:GetDescendants()) do
        if child:IsA("BasePart")
            and child.CanCollide == true
            and child.Name ~= floatName then

            child.CanCollide = false
        end
    end
end

function _G.NoclipModule.noclip()
    if not Clip then return end
    
    Clip = false
    task.wait(0.1)

    if Noclipping then
        Noclipping:Disconnect()
    end

    Noclipping = RunService.Stepped:Connect(NoclipLoop)
end

function _G.NoclipModule.clip()
    Clip = true
    if Noclipping then
        Noclipping:Disconnect()
        Noclipping = nil
    end

    -- restore collisions
    local char = LocalPlayer.Character
    if char then
        for _, child in ipairs(char:GetDescendants()) do
            if child:IsA("BasePart") then
                child.CanCollide = true
            end
        end
    end
end

function _G.NoclipModule.toggle()
    if Clip then
        _G.NoclipModule.noclip()
    else
        _G.NoclipModule.clip()
    end
end
